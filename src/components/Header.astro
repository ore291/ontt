---
import { Image } from "astro:assets";
import logo from "../images/logo.jpeg";
import { Menu, X, ChevronDown } from "@lucide/astro"

// Get current path for active link highlighting
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border transition-all">
  <nav class="container-custom flex justify-between items-center py-4">
    <!-- Logo - Responsive text size -->
    <a href="/" class="font-display text-lg sm:text-xl md:text-2xl font-bold gradient-text">
      <div class="hidden sm:flex items-center gap-2">
        <Image
          src={logo}
          alt="OVERNIGHT TRANSFORMATIONS logo"
          width={80}
          height={80}
        />
        <span>OVERNIGHT TRANSFORMATIONS</span>
      </div>

      <Image
        class="sm:hidden"
        src={logo}
        quality="max"
        alt="OVERNIGHT TRANSFORMATIONS logo"
        width={80}
        height={80}
      />
    </a>

    <!-- Desktop Navigation -->
    <ul class="hidden md:flex space-x-8 text-sm items-center">
      <li>
        <a 
          href="/waitlist" 
          class={`hover:text-[#CFB53B] transition-colors ${
            currentPath === "/waitlist" ? "text-[#CFB53B] font-semibold" : ""
          }`}
        >
          Join Waitlist
        </a>
      </li>
      
      <!-- Get Started Dropdown -->
      <li class="relative group">
        <button 
          class={`hover:text-[#CFB53B] transition-colors flex items-center gap-1 ${
            currentPath === "/questionnaire" || currentPath === "/roadmap" ? "text-primary font-semibold" : ""
          }`}
        >
          Get Started
          <ChevronDown class="h-4 w-4" />
        </button>
        <ul class="absolute left-0 top-full mt-2 w-48 bg-background border border-border rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <li>
            <a 
              href="/questionnaire" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/questionnaire" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              Questionnaire
            </a>
          </li>
          <li>
            <a 
              href="/roadmap" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/roadmap" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              Roadmap
            </a>
          </li>
        </ul>
      </li>

      <!-- Resources Dropdown -->
      <li class="relative group">
        <button 
          class={`hover:text-[#CFB53B] transition-colors flex items-center gap-1 ${
            currentPath === "/faq" || currentPath === "/why-ontt" ? "text-primary font-semibold" : ""
          }`}
        >
          Resources
          <ChevronDown class="h-4 w-4" />
        </button>
        <ul class="absolute left-0 top-full mt-2 w-48 bg-background border border-border rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <li>
            <a 
              href="/faq" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/faq" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              FAQ
            </a>
          </li>
          <li>
            <a 
              href="/why-ontt" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/why-ontt" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              Why ONT
            </a>
          </li>
        </ul>
      </li>

      <!-- Company Dropdown -->
      <li class="relative group">
        <button 
          class={`hover:text-[#CFB53B] transition-colors flex items-center gap-1 ${
            currentPath === "/about-us" || currentPath === "/creator-recruitment" || currentPath === "/contact-us" ? "text-primary font-semibold" : ""
          }`}
        >
          Company
          <ChevronDown class="h-4 w-4" />
        </button>
        <ul class="absolute left-0 top-full mt-2 w-48 bg-background border border-border rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <li>
            <a 
              href="/about-us" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/about-us" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              About Us
            </a>
          </li>
          <li>
            <a 
              href="/creator-recruitment" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/creator-recruitment" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              Become a Creator
            </a>
          </li>
          <li>
            <a 
              href="/contact-us" 
              class={`block px-4 py-2 hover:bg-primary/10 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/contact-us" ? "bg-primary/10 text-primary font-semibold" : ""
              }`}
            >
              Contact Us
            </a>
          </li>
        </ul>
      </li>

      <li>
        <a 
          href="/contact-us"
          class={`hover:text-[#CFB53B] transition-colors ${
            currentPath === "/contact-us" ? "text-[#CFB53B] font-semibold" : ""
          }`}
        >
          Contact Us
        </a>
      </li>
    </ul>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden p-2 hover:bg-primary/10 rounded-md transition-colors"
      aria-label="Toggle menu"
    >
      <span id="menu-icon">
        <Menu class="h-6 w-6 text-foreground" />
      </span>
      <span id="close-icon" class="hidden">
        <X class="h-6 w-6 text-foreground" />
      </span>
    </button>
  </nav>

  <!-- Mobile Navigation Menu -->
  <div id="mobile-menu" class="hidden md:hidden bg-background/98 backdrop-blur-sm border-t border-border">
    <ul class="container-custom py-6 space-y-4">
      <li>
        <a 
          href="/waitlist" 
          class={`block py-2 text-lg hover:text-[#CFB53B] transition-colors ${
            currentPath === "/waitlist" ? "text-primary font-semibold" : ""
          }`}
        >
          Join Waitlist
        </a>
      </li>
      
      <!-- Get Started Section -->
      <li>
        <button 
          id="get-started-toggle"
          class={`w-full text-left py-2 text-lg font-semibold flex items-center justify-between ${
            currentPath === "/questionnaire" || currentPath === "/roadmap" ? "text-primary" : ""
          }`}
        >
          Get Started
          <ChevronDown id="get-started-chevron" class="h-5 w-5 transition-transform" />
        </button>
        <ul id="get-started-menu" class="hidden pl-4 mt-2 space-y-2">
          <li>
            <a 
              href="/questionnaire" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/questionnaire" ? "text-primary font-semibold" : ""
              }`}
            >
              Questionnaire
            </a>
          </li>
          <li>
            <a 
              href="/roadmap" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/roadmap" ? "text-primary font-semibold" : ""
              }`}
            >
              Roadmap
            </a>
          </li>
        </ul>
      </li>

      <!-- Resources Section -->
      <li>
        <button 
          id="resources-toggle"
          class={`w-full text-left py-2 text-lg font-semibold flex items-center justify-between ${
            currentPath === "/faq" || currentPath === "/why-ontt" ? "text-primary" : ""
          }`}
        >
          Resources
          <ChevronDown id="resources-chevron" class="h-5 w-5 transition-transform" />
        </button>
        <ul id="resources-menu" class="hidden pl-4 mt-2 space-y-2">
          <li>
            <a 
              href="/faq" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/faq" ? "text-primary font-semibold" : ""
              }`}
            >
              FAQ
            </a>
          </li>
          <li>
            <a 
              href="/why-ontt" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/why-ontt" ? "text-primary font-semibold" : ""
              }`}
            >
              Why ONT
            </a>
          </li>
        </ul>
      </li>

      <!-- Company Section -->
      <li>
        <button 
          id="company-toggle"
          class={`w-full text-left py-2 text-lg font-semibold flex items-center justify-between ${
            currentPath === "/about-us" || currentPath === "/creator-recruitment" || currentPath === "/contact-us" ? "text-primary" : ""
          }`}
        >
          Company
          <ChevronDown id="company-chevron" class="h-5 w-5 transition-transform" />
        </button>
        <ul id="company-menu" class="hidden pl-4 mt-2 space-y-2">
          <li>
            <a 
              href="/about-us" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/about-us" ? "text-primary font-semibold" : ""
              }`}
            >
              About Us
            </a>
          </li>
          <li>
            <a 
              href="/creator-recruitment" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/creator-recruitment" ? "text-primary font-semibold" : ""
              }`}
            >
              Become a Creator
            </a>
          </li>
          <li>
            <a 
              href="/contact-us" 
              class={`block py-2 hover:text-[#CFB53B] transition-colors ${
                currentPath === "/contact-us" ? "text-primary font-semibold" : ""
              }`}
            >
              Contact Us
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    // Mobile menu toggle
    if (menuBtn && mobileMenu && menuIcon && closeIcon) {
      menuBtn.addEventListener("click", (e) => {
        e.preventDefault();
        console.log("ore");
        mobileMenu.classList.toggle("hidden");
        menuIcon.classList.toggle("hidden");
        closeIcon.classList.toggle("hidden");
      });
    }

    // Mobile submenu toggles
    const setupSubmenu = (toggleId: string, menuId: string, chevronId: string) => {
      const toggle = document.getElementById(toggleId);
      const menu = document.getElementById(menuId);
      const chevron = document.getElementById(chevronId);

      if (toggle && menu && chevron) {
        toggle.addEventListener("click", (e) => {
          e.preventDefault();
          menu.classList.toggle("hidden");
          chevron.classList.toggle("rotate-180");
        });
      }
    };

    setupSubmenu("get-started-toggle", "get-started-menu", "get-started-chevron");
    setupSubmenu("resources-toggle", "resources-menu", "resources-chevron");
    setupSubmenu("company-toggle", "company-menu", "company-chevron");

    // Close mobile menu when clicking a link
    const mobileLinks = document.querySelectorAll("#mobile-menu a");
    mobileLinks.forEach(link => {
      link.addEventListener("click", () => {
        if (mobileMenu) {
          mobileMenu.classList.add("hidden");
        }
        if (menuIcon) {
          menuIcon.classList.remove("hidden");
        }
        if (closeIcon) {
          closeIcon.classList.add("hidden");
        }
      });
    });
  }

  // Initialize on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initMobileMenu);
  } else {
    initMobileMenu();
  }

  // Re-initialize on page navigation (for Astro view transitions)
  document.addEventListener("astro:page-load", initMobileMenu);
</script>